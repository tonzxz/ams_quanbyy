<p-card header="Receiving" class="mb-4">
    <p>View orders incoming or orders already delivered here.</p>
    <p-tabView>
        <p-tabPanel header="Incoming">
            <p-table [value]="pendingOrders" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5,10,20]" [responsive]="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th>PR Number</th>
                        <th>Item Category</th>
                        <th>Date Ordered</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-order>
                    <tr>
                        <td>{{order.prNumber}}</td>
                        <td>{{order.itemCategory}}</td>
                        <td>{{order.dateOrdered}}</td>
                        <td>{{order.status}}</td>
                        <td>
                            <button pButton type="button" icon="pi pi-eye" [rounded]="true" [size]="'small'" pTooltip="View Items" (click)="openModal(order)" [style]="{'margin-right': '5px'}"></button>
                            <button pButton type="button" icon="pi pi-check" [outlined]="true" [rounded]="true" [size]="'small'" pTooltip="Set Order as delivered" (click)="confirmMarkAsReceived(order)" [style]="{'margin-right': '5px'}"></button>
                            <button pButton type="button" icon="pi pi-times" [outlined]="true" [rounded]="true" [size]="'small'" pTooltip="Reject order" class="p-button-danger" (click)="confirmRejectOrder(order)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-tabPanel>
        <p-tabPanel header="Delivered">
            <p-table [value]="deliveredOrders" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5,10,20]" [responsive]="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th>PR Number</th>
                        <th>Item Category</th>
                        <th>Date Ordered</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-order>
                    <tr>
                        <td>{{order.prNumber}}</td>
                        <td>{{order.itemCategory}}</td>
                        <td>{{order.dateOrdered}}</td>
                        <td>{{order.status}}</td>
                        <td>
                            <button pButton type="button" icon="pi pi-file-pdf" pTooltip="Export Receipt" [outlined]="true" [size]="'small'" (click)="exportPDF(order)"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-tabPanel>
    </p-tabView>
</p-card>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<p-dialog header="Order Details" [(visible)]="displayModal" [modal]="true" [closable]="true" [style]="{width: '50vw'}">
    <div *ngIf="selectedOrder">
        <h3>Order: {{selectedOrder.prNumber}}</h3>
        <p-table [value]="selectedOrder.items">
            <ng-template pTemplate="header">
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>Condition</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>
                <tr>
                    <td>{{item.name}}</td>
                    <td>{{item.quantity}}</td>
                    <td>{{item.condition}}</td>
                </tr>
            </ng-template>
        </p-table>
        <div class="flex justify-end mt-4 gap-4">
            <button pButton type="button" label="Reject" icon="pi pi-times" class="p-button-danger p-mr-2" (click)="confirmRejectOrder(selectedOrder)"></button>
            <button pButton type="button" label="Receive" icon="pi pi-check" class="p-button-success" (click)="confirmMarkAsReceived(selectedOrder)"></button>
        </div>
    </div>
</p-dialog>