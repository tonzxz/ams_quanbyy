<mat-card class="cardWithShadow">
  <mat-card-content>
    <mat-card-title>User Management</mat-card-title>
    <mat-card-subtitle class="text-sm text-gray-500">View and manage users in this section.</mat-card-subtitle>
    
    <div class="flex justify-between items-center mt-4">
 

       <p-button pTooltip="Add User"
            (click)="openNewUserDialog()"
            [outlined]="true" size="small"
            label="Add User" icon="pi pi-plus" />

    <div class="relative w-[300px]">
  <i class="pi pi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
  <input 
    pInputText 
    type="text" 
    #searchInput
    (input)="dt1.filterGlobal(searchInput.value, 'contains')"
    placeholder="Search Name"
    style="text-indent: 1.5rem;"
    class="w-full border border-gray-300 rounded-md py-2 pl-10 pr-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:ml-6"
  />
</div>

    </div>

    <p-table
        #dt1
        [value]="users"
        [rows]="10"
        [paginator]="true"
        [globalFilterFields]="['fullname', 'username', 'role']"
        [rowsPerPageOptions]="[5, 10, 20]"
        [loading]="loading"
        [showCurrentPageReport]="false"
        [responsive]="true"
        [rowHover]="true"
        [scrollable]="true"
        scrollHeight="600px"
        styleClass="p-datatable-sm"
        [tableStyle]="{'min-width': '60rem'}"
        dataKey="id"
    >
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="fullname">Full Name <p-sortIcon field="fullname"></p-sortIcon></th>
                <th pSortableColumn="username">Username <p-sortIcon field="username"></p-sortIcon></th>
                <th pSortableColumn="role">Role <p-sortIcon field="role"></p-sortIcon></th>
                <th class="w-[100px]">Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-user>
            <tr class="cursor-pointer">
                <td>{{ user.fullname }}</td>
                <td>{{ user.username }}</td>
               <td>
                <p-badge 
                    [value]="user.role" 
                    [severity]="getSeverity(user.role)" 
                    styleClass="text-capitalize"
                ></p-badge>
                </td>

                <td>
                   <div class="flex gap-2">
  <button 
    pButton 
    icon="pi pi-pencil" 
    class="p-button-rounded p-button-primary p-button-sm"
    [outlined]="true"
    (click)="editUser(user)"
  ></button>
  <button 
    pButton 
    icon="pi pi-trash" 
    class="p-button-rounded p-button-danger p-button-sm"
    [outlined]="true"
    (click)="deleteUser(user)"
  ></button>
</div>

                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4">
                    <div class="flex flex-col w-full items-center justify-center py-8">
                        <div class="overflow-hidden h-52 w-52 mb-4">
                            <!-- You can add an illustration here if needed -->
                        </div>
                        <span>No users found.</span>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>

    <!-- User Dialog Form -->
    <p-dialog 
        [(visible)]="userDialog" 
        [modal]="true" 
        [style]="{width: '90vw', maxWidth: '450px'}" 
        [header]="isEditMode ? 'Edit User' : 'Add New User'" 
        styleClass="p-fluid"
        [dismissableMask]="true"
        [draggable]="false"
        [resizable]="false"
        [position]="'center'"
    >
        <span class="text-gray-600 block">{{isEditMode ? 'Editing' : 'Adding new'}} user.</span>
        <small class="text-gray-500 block mb-4">(Please fill out all forms)</small>

        <form [formGroup]="userForm" class="w-full">
            <div class="flex items-center gap-4 mb-4">
                <label for="fullname" class="font-semibold w-24">Full Name</label>
                <div class="flex-auto flex-col flex">
                    <input 
                        type="text" 
                        pInputText 
                        id="fullname" 
                        formControlName="fullname" 
                        placeholder="Enter full name"
                        class="w-full"
                        required 
                        autofocus
                    />
                    <small class="self-end text-red-500 mt-1" *ngIf="submitted && userForm.get('fullname')?.errors?.['required']">
                        Full name is required.
                    </small>
                </div>
            </div>

            <div class="flex items-center gap-4 mb-4">
                <label for="username" class="font-semibold w-24">Username</label>
                <div class="flex-auto flex-col flex">
                    <input 
                        type="text" 
                        pInputText 
                        id="username" 
                        formControlName="username" 
                        placeholder="Enter username"
                        class="w-full"
                        required 
                    />
                    <small class="self-end text-red-500 mt-1" *ngIf="submitted && userForm.get('username')?.errors?.['required']">
                        Username is required.
                    </small>
                </div>
            </div>

            <div class="flex items-center gap-4 mb-4">
                <label for="password" class="font-semibold w-24">Password</label>
                <div class="flex-auto flex-col flex">
                    <input 
                        type="password" 
                        pInputText 
                        id="password" 
                        formControlName="password" 
                        placeholder="Enter password"
                        class="w-full"
                        [required]="!isEditMode"
                    />
                    <small class="self-end text-red-500 mt-1" *ngIf="submitted && userForm.get('password')?.errors?.['required']">
                        Password is required.
                    </small>
                    <small class="self-end text-red-500 mt-1" *ngIf="submitted && userForm.get('password')?.errors?.['minlength']">
                        Password must be at least 6 characters.
                    </small>
                </div>
            </div>

            <div class="flex items-center gap-4 mb-4">
                <label for="role" class="font-semibold w-24">Role</label>
                <div class="flex-auto flex-col flex">
                    <p-dropdown 
                        id="role" 
                        [options]="roles" 
                        formControlName="role" 
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select a Role"
                        [style]="{'width':'100%'}"
                        appendTo="body"
                    ></p-dropdown>
                    <small class="self-end text-red-500 mt-1" *ngIf="submitted && userForm.get('role')?.errors?.['required']">
                        Role is required.
                    </small>
                </div>
            </div>
        </form>

        <ng-template pTemplate="footer">
            <div class="flex justify-end gap-2">
                <button 
                    pButton 
                    label="Cancel" 
                    icon="pi pi-times" 
                    class="p-button-text" 
                    (click)="hideDialog()"
                    size="small"
                ></button>
                <button 
                    pButton 
                    label="Save" 
                    icon="pi pi-check" 
                    (click)="saveUser()"
                    size="small"
                ></button>
            </div>
        </ng-template>
    </p-dialog>

    <p-confirmDialog [style]="{width: '90vw', maxWidth: '450px'}" rejectButtonStyleClass="p-button-text"></p-confirmDialog>
    <p-toast position="bottom-right"></p-toast>
</mat-card-content>
</mat-card>








    
