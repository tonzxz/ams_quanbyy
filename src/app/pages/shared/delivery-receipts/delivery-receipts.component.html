<mat-card class="cardWithShadow">
  <mat-card-content>
    <mat-card-title>Delivery Receipts</mat-card-title>
    <mat-card-subtitle class="mat-body-1  mb-10">View, track and manage delivery receipts in this section.</mat-card-subtitle>
    <div class="card flex w-full py-3 px-4">
      <div class="flex-1 px-6">
        <p-stepper [(value)]="activeStep" class="w-full" fluid>
          <p-step-list>
            <p-step pTooltip="Click to show unverified receipts" [value]="1" class="flex flex-row flex-auto gap-2">
              <ng-template #content let-activateCallback="activateCallback" let-value="value">
                <button class="bg-transparent border-0 flex items-center gap-2 px-2" (click)="activateCallback();filterByStatus('unverified')">
                  <i [ngClass]="{'text-primary':value == activeStep}" class="pi pi-inbox mr-1"></i>
                  <span [ngClass]="{'text-primary':value == activeStep}">Unverified</span>
                </button>
              </ng-template>
            </p-step>
            <p-step pTooltip="Click to show processing receipts" [value]="2" class="flex flex-row flex-auto gap-2">
              <ng-template #content let-activateCallback="activateCallback" let-value="value">
                <button class="bg-transparent border-0 flex items-center gap-2 px-2" (click)="activateCallback();filterByStatus('processing')">
                  <i [ngClass]="{'text-primary':value == activeStep}" class="pi pi-spinner-dotted mr-1"></i>
                  <span [ngClass]="{'text-primary':value == activeStep}">Processing</span>
                </button>
              </ng-template>
            </p-step>
            <p-step pTooltip="Click to show verified receipts" [value]="3" class="flex flex-row flex-auto gap-2">
              <ng-template #content let-activateCallback="activateCallback" let-value="value">
                <button class="bg-transparent border-0 flex items-center gap-2 px-2" (click)="activateCallback();filterByStatus('verified')">
                  <i [ngClass]="{'text-primary':value == activeStep}" class="pi pi-verified mr-1"></i>
                  <span [ngClass]="{'text-primary':value == activeStep}">Verified</span>
                </button>
              </ng-template>
            </p-step>
          </p-step-list>
        </p-stepper>
      </div>
      <p-button pTooltip="Click to add new receipt" [outlined]="true" size="small" label="Add Receipt" (click)="openReceiptModal()" icon="pi pi-plus" />
      
    </div>
    <p-table
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
     [value]="filteredReceipts" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template #header>
        <tr>
          <th>Receipt Number</th>
          <th>Supplier Name</th>
          <th>Delivery Date</th>
          <th>Total Amount</th>
          <th style="width: 5rem"></th>
        </tr>
      </ng-template>

      <ng-template #body let-receipt>
        <tr>
          <td>
            <div class="flex gap-2.5 items-center">
              <i class="pi pi-receipt"></i>
              <span>{{ receipt.receipt_number }}</span>
            </div>
          </td>
          <td>{{ receipt.supplier_name }}</td>
          <td>{{ receipt.delivery_date | date: 'shortDate' }}</td>
          <td>{{ receipt.total_amount | currency:'PHP' }}</td>
          <td> 
            @if(receipt.status !='processing'){
              <div class="flex gap-3">
                @if(receipt.status != 'verified'){
                  <p-button severity="secondary" pTooltip="Click to edit receipt"
                  (click)="null" [outlined]="true" size="small" icon="pi pi-pencil" rounded />
                }
                <p-button severity="secondary" pTooltip="Click to view delivery receipt" [outlined]="true"
                    (click)="null" size="small" 
                    icon="pi pi-receipt" rounded />
                <p-button [outlined]="true" [severity]="getSeverityFromStatus(receipt.status)" pTooltip="{{receipt.status == 'verified'? 'Click to proceed to purchase orders':'Click to submit for inspection'}}"
                    (click)="null" size="small" 
                    icon="pi pi-arrow-right" rounded />
              </div>
            }@else{
              <div class="flex items-center justify-center gap-2 whitespace-nowrap">
                <i  class="pi  pi-spin pi-spinner-dotted mr-1"></i>
                <span>Under inspection ...</span>
              </div>
            }
          </td>
        </tr>
      </ng-template>
    </p-table>
  </mat-card-content>
</mat-card>

<p-dialog [(visible)]="showReceiptModal" [modal]="true" [style]="{ width: '30rem' }">
  <ng-template #header>
      <div class="py-0 inline-flex items-center justify-center gap-3">
        <i class="pi pi-box text-lg"></i>
        <span class="font-bold text-lg whitespace-nowrap">Add Receipt</span>
    </div>
  </ng-template>
  <span class="text-surface-500 dark:text-surface-400 block mb-2">Add a new receipt.</span>
  <form >
    <div class="flex items-center gap-4 mb-2">
      <label for="delivery_date" class="font-semibold w-32">Delivery Date</label>
      <p-datepicker fluid  [size]="'small'" class="flex-auto !text-xs" showIcon iconDisplay="input" formControlName="date" />
    </div>
    <div class="flex items-center gap-4 mb-2">
      <label for="receipt_number" class="font-semibold w-32">Receipt Number</label>
      <input pSize="small" formControlName="receipt_number" pInputText id="receipt_number" class="flex-auto" autocomplete="off" />
    </div>
    <div class="flex items-center gap-4 mb-2">
        <label for="supplier_name" class="font-semibold w-32">Supplier Name</label>
        <input  pSize="small" formControlName="supplier_name" pInputText id="receipt_number" class="flex-auto" autocomplete="off" />
    </div>

    <div class="flex items-center gap-4 mb-2">
      <label for="delivery_date" class="font-semibold w-32">Total Amount</label>
      <p-inputnumber size="small" class="flex-1" formControlName="total_amount" inputId="currency-us" mode="currency" currency="PHP" locale="en-PH" fluid />
    </div>
    <div class="flex items-center justify-center gap-4 mb-2">
      <p-fileupload name="receipt_image[]" url="/" (onUpload)="onUpload($event)" [multiple]="true" accept="image/*" maxFileSize="10000000" mode="advanced">
        <ng-template #empty>
            <div class="h-20">Drag and drop files to here to upload.</div>
        </ng-template>
        <ng-template #content>
            <ul *ngIf="uploadedFiles.length">
                <li *ngFor="let file of uploadedFiles">{{ file.name }} - {{ file.size }} bytes</li>
            </ul>
        </ng-template>
    </p-fileupload>
    
    </div>
    
  </form>
 
  <ng-template #footer>
      <p-button label="Cancel" [text]="true" severity="secondary" (click)="showReceiptModal = false" />
      <p-button label="Save" [outlined]="true" severity="secondary" (click)="showReceiptModal = false" />
  </ng-template>
</p-dialog>